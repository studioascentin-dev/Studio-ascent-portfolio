
/**
 * @fileoverview Firestore Security Rules for the portfolio application.
 *
 * Core Philosophy:
 * This ruleset provides public read access to projects and categories,
 * while restricting write access to these collections. Contact and support
 * requests are publicly accessible for both read and write to allow anonymous
 * users to submit the forms. Product ratings can be updated by anyone,
 * but only specific fields can be changed.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Grants public read access to projects and categories while denying all writes.
     * @path /projects/{projectId}
     */
    match /projects/{projectId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Grants public read access to categories while denying all writes.
     * @path /categories/{categoryId}
     */
    match /categories/{categoryId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Grants public read and write access to contacts.
     * @path /contacts/{contactId}
     */
    match /contacts/{contactId} {
      allow read, write: if true;
    }

    /**
     * @description Grants public read and write access to support requests.
     * @path /supportRequests/{supportRequestId}
     */
    match /supportRequests/{supportRequestId} {
      allow read, write: if true;
    }

    /**
     * @description Handles product ratings.
     * - Anyone can read products.
     * - Anyone can create a new product document (for initial rating).
     * - Anyone can update ONLY the 'ratingCount' and 'totalStars' fields.
     */
    match /products/{productId} {
      allow read: if true;
      allow create: if true;
      allow update: if request.resource.data.diff(resource.data).affectedKeys().hasOnly(['ratingCount', 'totalStars']);
      allow delete: if false;
    }
  }
}
